<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>OBZ • Прогрес місій</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#000; --text:#fff; --muted:#cfcfcf; --card:#0a0a0a;
      --stroke:#cfcfcf; --accent:#ff9e00; --track:#3a3a3a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text); background:var(--bg);
      font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      padding:18px;
    }

    /* фіксована ширина під 3 картки 170px з невеликим gap */
    .wrap{width:530px; margin:0 auto}

    .header{
      display:flex; align-items:flex-end; justify-content:space-between;
      min-height:70px; margin-bottom:10px;
    }
    .title{
      font-family:'Bebas Neue', sans-serif;
      font-size:60px; line-height:.9; letter-spacing:1px;
    }

    .grid{
      display:grid;
      gap:4px;                          /* зменшений проміжок між картками */
      grid-template-columns:repeat(3, 170px);
      margin-bottom:14px;
      justify-content:center;           /* без розтягування */
    }
    .card{
      background:var(--card);
      border:2px solid var(--stroke); border-radius:14px;
      padding:10px 12px;
      width:170px; height:250px;
      display:flex; flex-direction:column; justify-content:space-between;
    }
    .card .head{font-weight:800; font-size:18px; margin-bottom:10px;}
    .reading{display:flex; align-items:flex-end; gap:6px; line-height:1; margin-top:2px;}
    .reading .num{font-family:'Bebas Neue', sans-serif; font-size:52px}
    .reading .den{font-size:24px; color:#e6e6e6}
    .bar{height:8px; width:100%; border-radius:999px; background:var(--track); overflow:hidden; margin-top:8px;}
    .bar>span{display:block; height:100%; width:0%; background:var(--accent); transition:width .6s ease}

    /* текстові описи в картках */
    .details{
      font-size:12px; line-height:1.28; color:#ccc; margin-bottom:8px;
    }
    .gold{color:#ffcc00; font-weight:600;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title" id="title">WINDHUND</div>
    </div>

    <div class="grid">
      <!-- Авангард -->
      <div class="card">
        <div>
          <div class="head">Авангард</div>
          <div class="details">
            Важкий танк<br>
            Середній танк<br>
            ПТ-САУ<br><br>
            <span class="gold">Прорив</span><br>
            <span class="gold">Штурмовий</span><br>
            <span class="gold">Універсальний</span>
          </div>
        </div>
        <div>
          <div class="reading"><span id="n-avg" class="num">0</span><span class="den">/15</span></div>
          <div class="bar"><span id="b-avg"></span></div>
        </div>
      </div>

      <!-- Засідка -->
      <div class="card">
        <div>
          <div class="head">Засідка</div>
          <div class="details">
            Важкий танк<br>
            Середній танк<br>
            ПТ-САУ<br><br>
            <span class="gold">Снайпер</span><br>
            <span class="gold">Підтримка</span>
          </div>
        </div>
        <div>
          <div class="reading"><span id="n-zas" class="num">0</span><span class="den">/15</span></div>
          <div class="bar"><span id="b-zas"></span></div>
        </div>
      </div>

      <!-- Підтримка -->
      <div class="card">
        <div>
          <div class="head">Підтримка</div>
          <div class="details">
            Легкий танк<br>
            САУ
          </div>
        </div>
        <div>
          <div class="reading"><span id="n-pid" class="num">0</span><span class="den">/15</span></div>
          <div class="bar"><span id="b-pid"></span></div>
        </div>
      </div>
    </div>

    <!-- Загальний прогрес -->
    <div class="card" style="width:100%; height:80px; flex-direction:column; justify-content:space-between;">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <div class="head" style="font-size:20px;">Виконано завдань</div>
        <div class="reading"><span id="n-total" class="num">0</span><span class="den">/45</span></div>
      </div>
      <div class="bar"><span id="b-total"></span></div>
    </div>
  </div>

  <script>
    // Дані з Google Sheets
    const SHEET_ID   = '17phnEn-NW-OnrZg4DcW65r-Xoq6ScsdVjS5yL0SS3fk';
    const SHEET_NAME = 'OBZ';
    const MAX_CARD   = 15, MAX_TOTAL = 45, INTERVAL_MS = 15000;

    const toNum = v => (typeof v==='number')?v:(Number(String(v).replace(/[^\d.,-]/g,'').replace(',','.'))||0);
    const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

    async function fetchCell(a1){
      const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?headers=0&tqx=out:json&range=${encodeURIComponent(SHEET_NAME+'!'+a1)}`;
      const res=await fetch(url,{cache:'no-cache'}); const txt=await res.text();
      const json=JSON.parse(txt.substring(47).slice(0,-2));
      return json?.table?.rows?.[0]?.c?.[0]?.v ?? 0;
    }
    function setCard(numId,barId,val,max){
      const v=toNum(val);
      document.getElementById(numId).textContent=v;
      document.getElementById(barId).style.width=clamp((v/max)*100,0,100)+'%';
    }
    async function update(){
      try{
        const [B2,D2,F2] = await Promise.all([fetchCell('B2'),fetchCell('D2'),fetchCell('F2')]);
        const I2 = await fetchCell('I2');
        setCard('n-avg','b-avg',B2,MAX_CARD);
        setCard('n-zas','b-zas',D2,MAX_CARD);
        setCard('n-pid','b-pid',F2,MAX_CARD);
        setCard('n-total','b-total',I2,MAX_TOTAL);
      }catch(e){ console.error(e); }
    }
    update(); setInterval(update,INTERVAL_MS);
  </script>
</body>
</html>
