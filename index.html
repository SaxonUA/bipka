<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>OBZ • Прогрес місій</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#000; --text:#fff; --muted:#cfcfcf;
      --stroke:#cfcfcf; --accent:#ff9e00; --track:#3a3a3a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text); background:var(--bg);
      font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      padding:18px;
    }

    .wrap{width:530px; margin:0 auto}

    .header{
      position:relative;                 /* потрібно для позиціювання танка */
      display:flex; align-items:flex-end; justify-content:space-between;
      min-height:120px;                  /* більше місця під танк */
      margin-bottom:10px;
    }
    .title{
      font-family:'Bebas Neue', sans-serif;
      font-size:60px; line-height:.9; letter-spacing:1px;
      z-index:1;
    }
.tank{
  position:absolute;
  right:25px;     /* було right:-28px;  → тепер лівіше */
  top: 5px;       /* було top:-26px;   → опустив нижче */
  width:230px;
  pointer-events:none;
  filter: drop-shadow(0 10px 14px rgba(0,0,0,.6));
  z-index:2;
}

    .grid{
      display:grid;
      gap:4px;
      grid-template-columns:repeat(3, 170px);
      margin-bottom:14px;
      justify-content:center;
    }

    .card{
      background:rgba(0,0,0,0.6);              /* напівпрозорий чорний фон */
      border:2px solid var(--stroke); border-radius:14px;
      padding:10px 12px;
      width:170px; height:250px;
      display:flex; flex-direction:column; justify-content:space-between;
    }
    .card .head{font-weight:800; font-size:18px; margin-bottom:10px;}

    .details{font-size:12px; line-height:1.28; color:#ccc; margin-bottom:8px;}
    .gold-text{color:#ffcc00; font-weight:600;}

    .reading{
      display:flex; align-items:flex-end; justify-content:flex-end;
      gap:6px; line-height:1; margin-top:2px; width:100%;
    }
    .reading .num{font-family:'Bebas Neue', sans-serif; font-size:52px}
    .reading .den{font-size:24px; color:#e6e6e6}

    .bar{height:8px; width:100%; border-radius:999px; background:var(--track); overflow:hidden; margin-top:8px;}
    .bar>span{display:block; height:100%; width:0%; background:var(--accent); transition:width .6s ease}
    .bar.gold>span{background:#0fa8ab;}       /* ЗОЛОТИЙ для підсумку */
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title" id="title">WINDHUND</div>
      <!-- Зображення танка. Файл має лежати поруч з HTML -->
      <img class="tank" src="Windhund.png" alt="Windhund">
    </div>

    <div class="grid">
      <!-- Авангард -->
      <div class="card">
        <div>
          <div class="head">Авангард</div>
          <div class="details">
            Важкий танк<br>
            Середній танк<br>
            ПТ-САУ<br><br>
            <span class="gold-text">Прорив</span><br>
            <span class="gold-text">Штурмовий</span><br>
            <span class="gold-text">Універсальний</span>
          </div>
        </div>
        <div>
          <div class="reading"><span id="n-avg" class="num">0</span><span class="den">/15</span></div>
          <div class="bar"><span id="b-avg"></span></div>
        </div>
      </div>

      <!-- Засідка -->
      <div class="card">
        <div>
          <div class="head">Засідка</div>
          <div class="details">
            Важкий танк<br>
            Середній танк<br>
            ПТ-САУ<br><br>
            <span class="gold-text">Снайпер</span><br>
            <span class="gold-text">Підтримка</span>
          </div>
        </div>
        <div>
          <div class="reading"><span id="n-zas" class="num">0</span><span class="den">/15</span></div>
          <div class="bar"><span id="b-zas"></span></div>
        </div>
      </div>

      <!-- Підтримка -->
      <div class="card">
        <div>
          <div class="head">Підтримка</div>
          <div class="details">
            Легкий танк<br>
            САУ
          </div>
        </div>
        <div>
          <div class="reading"><span id="n-pid" class="num">0</span><span class="den">/15</span></div>
          <div class="bar"><span id="b-pid"></span></div>
        </div>
      </div>
    </div>

    <!-- Загальний прогрес із ЗОЛОТИМ баром -->
    <div class="card" style="width:100%; height:96px; flex-direction:column; justify-content:space-between;">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <div class="head" style="font-size:20px; margin-bottom:0;">Виконано завдань</div>
        <div class="reading"><span id="n-total" class="num">0</span><span class="den">/45</span></div>
      </div>
      <div class="bar gold"><span id="b-total"></span></div>
    </div>
  </div>

  <script>
    // Дані з Google Sheets
    const SHEET_ID   = '17phnEn-NW-OnrZg4DcW65r-Xoq6ScsdVjS5yL0SS3fk';
    const SHEET_NAME = 'OBZ';
    const MAX_CARD   = 15, MAX_TOTAL = 45, INTERVAL_MS = 15000;

    const toNum = v => (typeof v==='number')?v:(Number(String(v).replace(/[^\d.,-]/g,'').replace(',','.'))||0);
    const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

    async function fetchCell(a1){
      const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?headers=0&tqx=out:json&range=${encodeURIComponent(SHEET_NAME+'!'+a1)}`;
      const res=await fetch(url,{cache:'no-cache'}); const txt=await res.text();
      const json=JSON.parse(txt.substring(47).slice(0,-2));
      return json?.table?.rows?.[0]?.c?.[0]?.v ?? 0;
    }

    function setCard(numId,barId,val,max){
      const v=toNum(val);
      document.getElementById(numId).textContent=v;
      const pct = clamp((v/max)*100, 0, 100);
      document.getElementById(barId).style.width = pct + '%';
    }

    async function update(){
      try{
        const [B2,D2,F2] = await Promise.all([
          fetchCell('B2'), fetchCell('D2'), fetchCell('F2')
        ]);
        const I2 = await fetchCell('I2');

        setCard('n-avg','b-avg',B2,MAX_CARD);
        setCard('n-zas','b-zas',D2,MAX_CARD);
        setCard('n-pid','b-pid',F2,MAX_CARD);
        setCard('n-total','b-total',I2,MAX_TOTAL);
      }catch(e){ console.error(e); }
    }

    update();
    setInterval(update, INTERVAL_MS);
  </script>
</body>
</html>
